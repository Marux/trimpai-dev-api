# üöÄ Portfolio Backend API

<p align="center">
  <a href="http://nestjs.com/" target="blank">
    <img src="https://nestjs.com/img/logo-small.svg" width="120" alt="Nest Logo" />
  </a>
</p>

<p align="center">
  <strong>API backend profesional para portafolio y blog personal</strong><br>
  Construida con NestJS, TypeScript, JWT Authentication y MySQL
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Estado-üöß%20En%20Construcci√≥n-yellow" alt="En Construcci√≥n" />
  <img src="https://img.shields.io/badge/Versi√≥n-1.0.0--dev-orange" alt="Versi√≥n" />
  <img src="https://img.shields.io/badge/NestJS-E0234E?style=flat&logo=nestjs&logoColor=white" alt="NestJS" />
  <img src="https://img.shields.io/badge/TypeScript-007ACC?style=flat&logo=typescript&logoColor=white" alt="TypeScript" />
</p>

<p align="center">
  <a href="#-caracter√≠sticas">Caracter√≠sticas</a> ‚Ä¢
  <a href="#-tecnolog√≠as">Tecnolog√≠as</a> ‚Ä¢
  <a href="#-instalaci√≥n">Instalaci√≥n</a> ‚Ä¢
  <a href="#-api-documentation">API Docs</a> ‚Ä¢
  <a href="#-contacto">Contacto</a>
</p>

---

> **‚ö†Ô∏è PROYECTO EN DESARROLLO**  
> Esta API est√° actualmente en construcci√≥n como parte del desarrollo del portafolio personal. Algunas funcionalidades pueden estar incompletas o sujetas a cambios.

## üìã Descripci√≥n

Esta es la API central del portafolio y blog profesional de **V√≠ctor Trimpai**. Una aplicaci√≥n backend robusta y escalable que proporciona todos los servicios necesarios para gestionar proyectos, publicaciones de blog y la interacci√≥n con usuarios de manera segura y eficiente.

### üéØ Prop√≥sito

- **Portafolio Digital**: Gesti√≥n de proyectos destacados y informaci√≥n profesional
- **Blog T√©cnico**: Plataforma para compartir experiencias y conocimientos en desarrollo
- **Sistema de Noticias**: Gesti√≥n completa de noticias con sistema de revisiones y estados
- **Sistema de Usuarios**: Autenticaci√≥n segura con roles y permisos
- **Gesti√≥n de Estados**: Control centralizado de estados de workflow para noticias
- **API RESTful**: Endpoints bien documentados para integraci√≥n con frontend

## ‚ú® Caracter√≠sticas

### üîê **Autenticaci√≥n y Seguridad**
- Autenticaci√≥n JWT con cookies seguras
- Sistema de roles (Administrador, Editor, Usuario, Invitado)
- Encriptaci√≥n de contrase√±as con bcrypt
- Validaci√≥n de datos con class-validator
- CORS habilitado para frontend

### üë• **Gesti√≥n de Usuarios**
- Registro y login de usuarios
- Perfiles de usuario con informaci√≥n profesional
- Sistema de permisos basado en roles
- Seguimiento de actividad de login

### üì∞ **Sistema de Noticias**
- Creaci√≥n y gesti√≥n de noticias con contenido rich media
- Sistema de revisiones y aprobaciones
- Estados de publicaci√≥n (pendiente, revisi√≥n, publicado)
- Gesti√≥n de vigencia de noticias
- Contador de visitas autom√°tico
- Soft delete para preservar datos
- Soporte para im√°genes, videos y p√°rrafos estructurados
- Categorizaci√≥n de noticias

### üîÑ **Gesti√≥n de Estados**
- Estados predefinidos para workflow de noticias
- Estados personalizables por administradores
- Sistema de activaci√≥n/desactivaci√≥n de estados
- Control de visibilidad p√∫blica de estados
- Seed autom√°tico de estados base al iniciar la aplicaci√≥n
- Soft delete para preservar integridad de datos

### üèóÔ∏è **Arquitectura S√≥lida**
- Patr√≥n Repository con TypeORM
- Inyecci√≥n de dependencias
- Manejo centralizado de errores
- Validaci√≥n autom√°tica de DTOs
- Documentaci√≥n autom√°tica con Swagger

### üõ†Ô∏è **Administraci√≥n**
- Panel administrativo autom√°tico
- Usuario administrador por defecto
- Gesti√≥n completa de roles y permisos
- Sistema de workflow para noticias
- Gesti√≥n centralizada de estados
- Logs detallados del sistema

## üîß Tecnolog√≠as

| Categor√≠a | Tecnolog√≠as |
|-----------|-------------|
| **Framework** | NestJS, Node.js, TypeScript |
| **Base de Datos** | MySQL, TypeORM |
| **Autenticaci√≥n** | JWT, bcrypt, Passport |
| **Validaci√≥n** | class-validator, class-transformer |
| **Documentaci√≥n** | Swagger/OpenAPI |
| **Contenedores** | Docker, Docker Compose |
| **Herramientas** | pnpm, ESLint, Prettier |

## üöÄ Instalaci√≥n

### Prerequisitos

- Node.js (v18 o superior)
- pnpm
- MySQL 8.0
- Docker (opcional)

### Opci√≥n 1: Instalaci√≥n Local

1. **Clonar el repositorio**
   ```bash
   git clone https://github.com/tuusuario/portfolio-backend.git
   cd portfolio-backend
   ```

2. **Instalar dependencias**
   ```bash
   cd backend
   pnpm install
   ```

3. **Configurar variables de entorno**
   ```bash
   cp .env.example .env
   ```
   
   Edita el archivo `.env` con tus configuraciones:
   ```env
   # Base de datos
   DB_HOST=localhost
   DB_PORT=3306
   DB_USERNAME=tu_usuario
   DB_PASSWORD=tu_password
   DB_DATABASE=portfolio_db
   
   # JWT
   JWT_SECRET=tu_jwt_secret_muy_seguro
   
   # Usuario Admin por defecto
   DEFAULT_ADMIN_EMAIL=admin@tudominio.com
   DEFAULT_ADMIN_PASSWORD=TuPasswordSeguro123!
   DEFAULT_ADMIN_RUN=12345678-9
   ```

4. **Ejecutar la aplicaci√≥n**
   ```bash
   # Desarrollo
   pnpm run start:dev
   
   # Producci√≥n
   pnpm run start:prod
   ```

### Opci√≥n 2: Docker Compose

1. **Preparar el entorno**
   ```bash
   cd backend
   pnpm install
   ```

2. **Configurar variables de entorno para Docker**
   ```bash
   cp .env.example .env
   ```
   
   Ejemplo de configuraci√≥n `.env` para Docker:
   ```env
   # Base de datos (para Docker)
   DB_HOST=mysql_db
   DB_PORT=3306
   DB_USERNAME=user_crud
   DB_PASSWORD=root
   DB_DATABASE=db_crud
   
   # JWT
   JWT_SECRET=s3cr3t_cl4ve_supersegura
   JWT_EXPIRES_IN=1h
   
   # Usuario Admin por defecto
   DEFAULT_ADMIN_EMAIL=admin@blog.com
   DEFAULT_ADMIN_PASSWORD=UnaContrase√±aMuySegura123!
   DEFAULT_ADMIN_RUN=12345678-9
   ```

3. **Levantar los servicios**
   ```bash
   docker-compose up -d
   ```

La aplicaci√≥n estar√° disponible en `http://localhost:3000`

## üìñ API Documentation

### Swagger UI
Una vez que la aplicaci√≥n est√© ejecut√°ndose, visita:
- **Documentaci√≥n interactiva**: `http://localhost:3000/docs`
- **Redirecci√≥n autom√°tica**: `http://localhost:3000/` ‚Üí `/docs`

### Endpoints Principales

#### üîê Autenticaci√≥n (`/auth`)
| M√©todo | Endpoint | Descripci√≥n | Requiere Auth | Rol Requerido |
|--------|----------|-------------|---------------|---------------|
| `POST` | `/auth/login` | Iniciar sesi√≥n | ‚ùå | - |
| `POST` | `/auth/logout` | Cerrar sesi√≥n | ‚ùå | - |
| `POST` | `/auth/createUser` | Registrar nuevo usuario | ‚ùå | - |

#### üë• Gesti√≥n de Roles (`/rol`)
| M√©todo | Endpoint | Descripci√≥n | Requiere Auth | Rol Requerido |
|--------|----------|-------------|---------------|---------------|
| `GET` | `/rol` | Listar todos los roles | ‚úÖ | Administrador |
| `POST` | `/rol` | Crear nuevo rol | ‚úÖ | Administrador |
| `GET` | `/rol/:id` | Obtener rol por ID | ‚úÖ | Administrador |
| `PATCH` | `/rol/:id` | Actualizar rol | ‚úÖ | Administrador |
| `PATCH` | `/rol/desactivate/:id` | Desactivar rol | ‚úÖ | Administrador |
| `DELETE` | `/rol/:id` | Eliminar rol | ‚úÖ | Administrador |

#### üîÑ Gesti√≥n de Estados (`/estados`)
| M√©todo | Endpoint | Descripci√≥n | Requiere Auth | Rol Requerido |
|--------|----------|-------------|---------------|---------------|
| `GET` | `/estados` | Listar todos los estados | ‚úÖ | Admin/Editor |
| `POST` | `/estados` | Crear nuevo estado | ‚úÖ | Administrador |
| `GET` | `/estados/:id` | Obtener estado por ID | ‚úÖ | Admin/Editor |
| `PATCH` | `/estados/:id` | Actualizar estado | ‚úÖ | Administrador |
| `PATCH` | `/estados/:id/desactivate` | Desactivar estado | ‚úÖ | Administrador |
| `PATCH` | `/estados/:id/reactivate` | Reactivar estado | ‚úÖ | Administrador |
| `DELETE` | `/estados/:id` | Eliminar estado (soft delete) | ‚úÖ | Administrador |

#### üì∞ Gesti√≥n de Noticias (`/noticias`)
| M√©todo | Endpoint | Descripci√≥n | Requiere Auth | Rol Requerido |
|--------|----------|-------------|---------------|---------------|
| `GET` | `/noticias` | Listar noticias p√∫blicas | ‚ùå | - |
| `GET` | `/noticias/findAll` | Listar todas las noticias | ‚úÖ | Admin/Editor/Usuario |
| `GET` | `/noticias/getPendingRev` | Noticias pendientes de revisi√≥n | ‚úÖ | Admin/Editor/Usuario |
| `GET` | `/noticias/:id` | Obtener noticia por ID | ‚ùå | - |
| `POST` | `/noticias` | Crear nueva noticia | ‚úÖ | Admin/Editor/Usuario |
| `PATCH` | `/noticias/:id` | Actualizar noticia | ‚úÖ | Admin/Editor/Usuario |
| `PATCH` | `/noticias/:id/desactivate` | Desactivar noticia | ‚úÖ | Admin/Editor |
| `PATCH` | `/noticias/:id/reactivate` | Reactivar noticia | ‚úÖ | Admin/Editor |
| `PATCH` | `/noticias/:id/vigencia` | Cambiar vigencia | ‚úÖ | Admin/Editor |
| `DELETE` | `/noticias/:id` | Eliminar noticia (soft delete) | ‚úÖ | Administrador |

### Autenticaci√≥n

La API utiliza **JWT con cookies HTTP-only** para la autenticaci√≥n. El flujo es el siguiente:

#### üîë **Proceso de Login**
```javascript
// Request al login
POST /auth/login
{
  "email": "usuario@email.com",
  "password": "tu_password"
}

// Respuesta exitosa
{
  "message": "Login exitoso"
}

// El JWT se almacena autom√°ticamente en una cookie HTTP-only
// Cookie: access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

#### üö™ **Logout**
```javascript
POST /auth/logout
// Respuesta
{
  "message": "Logout exitoso"
}
// La cookie se elimina autom√°ticamente
```

#### üõ°Ô∏è **Endpoints Protegidos**
Los endpoints protegidos requieren:
- **JWT v√°lido** (enviado autom√°ticamente via cookie)
- **Rol apropiado** (verificado por guards)

#### üë§ **Registro de Usuarios**
```javascript
POST /auth/createUser
{
  "run": "12345678-9",
  "nombre": "Juan P√©rez",
  "email": "juan@email.com",
  "password": "password123"
}
```

### Sistema de Estados

#### üìä **Estados Predefinidos**
El sistema crea autom√°ticamente los siguientes estados base:
- **Pendiente de Revisi√≥n** (No p√∫blico)
- **Aprobado** (P√∫blico)
- **Rechazado** (No p√∫blico)
- **Solicitud de Cambio** (No p√∫blico)

#### üîÑ **Crear Estado**
```javascript
POST /estados
{
  "nombre": "En Revisi√≥n T√©cnica",
  "publica": false
}

// Respuesta
{
  "message": "‚úÖ Estado creado exitosamente",
  "data": {
    "id": "uuid-del-estado",
    "nombre": "En Revisi√≥n T√©cnica",
    "publica": false,
    "status": true,
    "createdBy": "uuid-del-usuario"
  }
}
```

#### üîç **Obtener Estados**
```javascript
GET /estados
// Respuesta
{
  "message": "‚úÖ Listado de estados",
  "data": [
    {
      "id": "uuid",
      "nombre": "Pendiente de Revisi√≥n",
      "publica": false,
      "status": true,
      "createdBy": "system"
    },
    {
      "id": "uuid",
      "nombre": "Aprobado",
      "publica": true,
      "status": true,
      "createdBy": "system"
    }
  ]
}
```

#### ‚öôÔ∏è **Gesti√≥n de Estados**
```javascript
// Desactivar estado
PATCH /estados/{id}/desactivate
// Respuesta: "‚úÖ Estado desactivado exitosamente"

// Reactivar estado
PATCH /estados/{id}/reactivate
// Respuesta: "‚úÖ Estado re-activado exitosamente"

// Actualizar estado
PATCH /estados/{id}
{
  "nombre": "Nuevo nombre",
  "publica": true
}
// Respuesta: "‚úÖ Estado actualizado exitosamente"
```

### Sistema de Noticias

#### üìù **Crear Noticia**
```javascript
POST /noticias
{
  "titulo": "Mi primera noticia",
  "descripcion": "Descripci√≥n de la noticia",
  "contenido": "Contenido completo de la noticia..."
}

// Respuesta
{
  "message": "‚úÖ Noticia creada exitosamente y marcada como pendiente de revisi√≥n",
  "id": "uuid-de-la-noticia"
}
```

#### üîç **Obtener Noticias P√∫blicas**
```javascript
GET /noticias
// Respuesta
{
  "message": "‚úÖ Se encontraron 5 noticias publicadas",
  "noticias": [
    {
      "id": "uuid",
      "titulo": "T√≠tulo de la noticia",
      "descripcion": "Descripci√≥n",
      "visitas": 42,
      "usuario": {
        "nombre": "V√≠ctor Trimpai"
      },
      "imagenes": [...],
      "categorias": [...],
      "parrafos": [...],
      "videos": [...]
    }
  ]
}
```

#### üìä **Estados de Noticias**
Las noticias utilizan el sistema de estados para su workflow:
- **Pendiente de Revisi√≥n**: Estado inicial al crear una noticia
- **En Revisi√≥n**: Cuando est√° siendo revisada por un editor
- **Aprobada**: Lista para publicaci√≥n
- **Publicada**: Visible p√∫blicamente
- **Rechazada**: Necesita correcciones

#### üîÑ **Workflow de Noticias**
1. **Creaci√≥n**: Usuario crea noticia ‚Üí Estado "Pendiente de Revisi√≥n"
2. **Revisi√≥n**: Editor/Admin revisa ‚Üí Cambia a estado apropiado
3. **Publicaci√≥n**: Si est√° aprobada ‚Üí Se puede publicar
4. **Gesti√≥n**: Cambiar vigencia, desactivar o reactivar

> **Nota**: Los nuevos usuarios se crean autom√°ticamente con rol "Usuario"

## üß™ Testing

```bash
# Tests unitarios
pnpm run test

# Tests e2e
pnpm run test:e2e

# Cobertura de tests
pnpm run test:cov
```

## üìÅ Estructura del Proyecto

```
src/
‚îú‚îÄ‚îÄ authService/           # M√≥dulo de autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ auth.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ guards/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt-auth.guard.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roles.guard.ts
‚îÇ   ‚îî‚îÄ‚îÄ auth.module.ts
‚îú‚îÄ‚îÄ roles/                 # M√≥dulo de roles
‚îÇ   ‚îú‚îÄ‚îÄ role.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ role.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ role.module.ts
‚îú‚îÄ‚îÄ estados/               # M√≥dulo de estados
‚îÇ   ‚îú‚îÄ‚îÄ estados.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ estados.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-estado.dto.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ update-estado.dto.ts
‚îÇ   ‚îî‚îÄ‚îÄ estados.module.ts
‚îú‚îÄ‚îÄ noticias/              # M√≥dulo de noticias
‚îÇ   ‚îú‚îÄ‚îÄ noticias.controller.ts
‚îÇ   ‚îú‚îÄ‚îÄ noticias.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ create-noticia.dto.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ update-noticia.dto.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ public-noticia.dto.ts
‚îÇ   ‚îî‚îÄ‚îÄ noticias.module.ts
‚îú‚îÄ‚îÄ entities/              # Entidades de base de datos
‚îÇ   ‚îú‚îÄ‚îÄ Usuario.entity.ts
‚îÇ   ‚îú‚îÄ‚îÄ Rol.entity.ts
‚îÇ   ‚îú‚îÄ‚îÄ Login.entity.ts
‚îÇ   ‚îú‚îÄ‚îÄ Noticia.entity.ts
‚îÇ   ‚îú‚îÄ‚îÄ Revision.entity.ts
‚îÇ   ‚îî‚îÄ‚îÄ Estado.entity.ts
‚îú‚îÄ‚îÄ decorators/            # Decoradores personalizados
‚îÇ   ‚îú‚îÄ‚îÄ user.decorator.ts
‚îÇ   ‚îú‚îÄ‚îÄ roles.decorator.ts
‚îÇ   ‚îî‚îÄ‚îÄ public.decorator.ts
‚îú‚îÄ‚îÄ interfaces/            # Interfaces TypeScript
‚îÇ   ‚îî‚îÄ‚îÄ jwt-payload.interface.ts
‚îú‚îÄ‚îÄ dto/                   # Data Transfer Objects
‚îÇ   ‚îú‚îÄ‚îÄ create-user.dto.ts
‚îÇ   ‚îî‚îÄ‚îÄ create-rol.dto.ts
‚îú‚îÄ‚îÄ utils/                 # Utilidades
‚îÇ   ‚îî‚îÄ‚îÄ error.utils.ts
‚îú‚îÄ‚îÄ app.module.ts          # M√≥dulo principal
‚îî‚îÄ‚îÄ main.ts               # Punto de entrada
```

## üîí Seguridad

### Caracter√≠sticas de Seguridad Implementadas

- ‚úÖ **Encriptaci√≥n de contrase√±as** con bcrypt
- ‚úÖ **JWT tokens** para autenticaci√≥n stateless
- ‚úÖ **Validaci√≥n de entrada** con class-validator
- ‚úÖ **CORS configurado** para frontends espec√≠ficos
- ‚úÖ **Cookies seguras** con httpOnly
- ‚úÖ **Guards de roles** para control de acceso
- ‚úÖ **Endpoints p√∫blicos** claramente marcados
- ‚úÖ **Soft delete** para preservar integridad de datos
- ‚úÖ **Rate limiting** (recomendado para producci√≥n)
- ‚úÖ **Sanitizaci√≥n de datos** autom√°tica

### Usuario Administrador por Defecto

Al iniciar la aplicaci√≥n por primera vez, se crea autom√°ticamente:

- **Email**: El configurado en `DEFAULT_ADMIN_EMAIL`
- **Contrase√±a**: La configurada en `DEFAULT_ADMIN_PASSWORD`
- **Rol**: Administrador con todos los permisos

### Estados Base

Al iniciar la aplicaci√≥n, se crean autom√°ticamente los estados base necesarios para el workflow de noticias:
- **Pendiente de Revisi√≥n** (No p√∫blico)
- **Aprobado** (P√∫blico)
- **Rechazado** (No p√∫blico)
- **Solicitud de Cambio** (No p√∫blico)

> ‚ö†Ô∏è **Importante**: Cambia las credenciales por defecto despu√©s del primer login

## üö¢ Deployment

### Preparaci√≥n para Producci√≥n

1. **Variables de entorno de producci√≥n**
   ```bash
   NODE_ENV=production
   JWT_SECRET=tu_jwt_secret_muy_seguro_para_produccion
   ```

2. **Build del proyecto**
   ```bash
   pnpm run build
   pnpm run start:prod
   ```

### Plataformas Recomendadas

- **Railway**, **Render**, **DigitalOcean App Platform**
- **AWS EC2** con PM2 para gesti√≥n de procesos
- **Google Cloud Run** para contenedores
- **VPS** con Docker Compose

## ü§ù Contribuci√≥n

¬°Las contribuciones son bienvenidas! Este proyecto est√° en desarrollo activo, por lo que hay muchas oportunidades para colaborar.

### üõ†Ô∏è **C√≥mo contribuir:**

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abre un Pull Request

### üéØ **√Åreas donde puedes ayudar:**
- üìù Mejorar documentaci√≥n
- üß™ Agregar tests unitarios y e2e
- üîí Mejorar medidas de seguridad
- üöÄ Optimizaci√≥n de performance
- üì∞ Mejoras en el sistema de noticias
- üîÑ Mejoras en el sistema de estados
- üìä Implementar sistema de notificaciones
- üêõ Reportar y corregir bugs

> **Nota**: Como el proyecto est√° en construcci√≥n, algunas funcionalidades pueden cambiar. ¬°Mantente al d√≠a con los issues y discussions!

## üìû Contacto

**V√≠ctor Trimpai** - Desarrollador Full Stack

- üìß **Email**: victor.trimpai1987@gmail.com
- üíº **LinkedIn**: [linkedin.com/in/victor-trimpai-dev](https://www.linkedin.com/in/victor-trimpai-dev/)
- üêô **GitHub**: [github.com/Marux](https://github.com/Marux)
- üåê **Portfolio**: [üöß En construcci√≥n - Powered by this API! üöß]

---

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para m√°s detalles.

> **Nota**: Proyecto en desarrollo - La licencia puede actualizarse seg√∫n evolucione el proyecto.

---

<p align="center">
  <strong>üöß Proyecto en desarrollo activo üöß</strong><br>
  <sub>Si encuentras alg√∫n bug o tienes sugerencias, ¬°no dudes en abrir un issue!</sub>
</p>

<p align="center">
  <strong>¬øTe gusta este proyecto? ¬°Dale una ‚≠ê en GitHub!</strong><br>
  <sub>Desarrollado con ‚ù§Ô∏è para la comunidad de desarrolladores</sub>
</p>